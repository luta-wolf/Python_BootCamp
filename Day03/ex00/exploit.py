# перед запуском, запустить сервер  командой `python3 -m http.server`


from bs4 import BeautifulSoup as BS
import requests

def main():
    with open("../../materials/evilcorp.html", 'r') as fp:
        soup = BS(fp, 'html.parser')

    # url = 'http://127.0.0.1:8000/evilcorp.html'
    # response = requests.get(url)
    # soup = BS(response.text, 'html.parser')

    # Посмотреть заголовок
    title = soup.title.string
    # Поменять заголовок
    soup.title.string = "Evil Corp - Stealing your money every day"

    username = soup.find('span').text
    h1_tag = BS().new_tag('h1')

    h1_tag.string = username + ', you are hacked!'
    soup.body.insert(0, h1_tag)

    script_tag = BS().new_tag('script')
    script_tag.string = '''
        hacked = function() {
            alert('hacked');
        }
        window.addEventListener('load', 
          function() { 
            var f = document.querySelector("form");
            f.setAttribute("onsubmit", "hacked()");
          },
          false
        );

    '''

    soup.body.append(script_tag)
    hacked_link = soup.find_all('a')[0]
    hacked_link.string = "Fsociety"
    hacked_link['href'] = "https://mrrobot.fandom.com/wiki/Fsociety"

    with open("evilcorp_hacked.html", "w") as file:
        file.write(str(soup))



if __name__ == "__main__":
    main()